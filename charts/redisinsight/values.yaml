# =============================================================================
# Global Parameters
# @section -- Global Parameters
# =============================================================================

# -- Override the namespace for all resources
# @default -- `.Release.Namespace`
namespaceOverride: ""

# -- Override the name of the chart
nameOverride: ""

# -- Override the full name of the chart
fullnameOverride: ""

# -- Additional labels to add to all resources
additionalLabels: {}

# -- Additional annotations to add to all resources
additionalAnnotations: {}

# =============================================================================
# Image Configuration
# @section -- Image Configuration
# =============================================================================

image:
  # -- Redis Insight Docker image repository
  repository: redis/redisinsight
  # -- Redis Insight Docker image tag
  # @default -- Chart appVersion
  tag: "latest"
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Image digest (overrides tag if set)
  digest: ""

# -- Image pull secrets for private registries
imagePullSecrets: []

# =============================================================================
# Redis Insight Configuration
# @section -- Redis Insight Configuration
# =============================================================================

redisInsight:
  # -- Application port that Redis Insight listens on
  port: 5540

  # -- Application host that Redis Insight binds to
  host: "0.0.0.0"

  # -- Log level for the application
  # Supported levels: error, warn, info, http, verbose, debug, silly
  logLevel: "info"

  # -- Enable file logging
  filesLogger: true

  # -- Enable stdout logging
  stdoutLogger: true

  # -- Proxy path for reverse proxy subdirectory hosting
  # Set this when hosting Redis Insight under a subdirectory (e.g., /redisinsight)
  proxyPath: ""

  # -- Enable/disable database connection management
  # When false, disables the ability to add, edit, or delete database connections
  databaseManagement: true

  # -- Encryption key for sensitive data
  # Redis Insight stores sensitive information (passwords, history, etc.) encrypted
  # The same key should be provided for subsequent starts with the same volume
  encryptionKey: ""

  # -- Name of an existing secret containing the encryption key
  # The secret must contain a key 'encryptionKey'
  existingEncryptionKeySecret: ""

  # -- Key in existingEncryptionKeySecret that contains the encryption key
  existingEncryptionKeySecretKey: "encryptionKey"

  # -- TLS/SSL configuration for HTTPS
  tls:
    # -- Enable TLS/SSL
    enabled: false
    # -- TLS private key (PEM format)
    # Can be a path to a file or a string in PEM format
    key: ""
    # -- TLS certificate (PEM format)
    # Can be a path to a file or a string in PEM format
    cert: ""
    # -- Name of an existing secret containing TLS key and cert
    existingSecret: ""
    # -- Key in existingSecret for TLS private key
    existingSecretKeyKey: "tls.key"
    # -- Key in existingSecret for TLS certificate
    existingSecretCertKey: "tls.crt"

  # -- Pre-configured Redis database connections
  # Configure Redis connections using environment variables
  # Each connection needs a unique ID (replace * with a number)
  # Example:
  # connections:
  #   - id: "1"
  #     host: "redis.default.svc.cluster.local"
  #     port: 6379
  #     alias: "Production Redis"
  #     username: "default"
  #     password: "password123"
  #     tls: false
  #   - id: "2"
  #     host: "redis-cluster.database.svc"
  #     port: 6379
  #     alias: "Redis Cluster"
  #     tls: true
  #     tlsCaBase64: "LS0tLS1CRUdJTi..."
  connections: []

  # -- Name of an existing secret containing Redis connection passwords
  # Expected format: secret with keys like "password-1", "password-2", etc.
  existingConnectionPasswordsSecret: ""

# =============================================================================
# Controller Configuration
# @section -- Controller Configuration
# =============================================================================

controller:
  # -- Controller type (deployment or statefulset)
  type: deployment

  # -- Number of Redis Insight replicas
  replicas: 1

  # -- Deployment update strategy
  strategy:
    type: Recreate

  # -- StatefulSet update strategy (only used if controller.type is statefulset)
  updateStrategy:
    type: RollingUpdate

  # -- Pod management policy (only used if controller.type is statefulset)
  podManagementPolicy: OrderedReady

  # -- Command override for the main container
  command: []

  # -- Args override for the main container
  args: []

  # -- Working directory for the main container
  workingDir: ""

  # -- Termination grace period in seconds
  terminationGracePeriodSeconds: 30

  # -- Lifecycle hooks for the main container
  lifecycle: {}
    # preStop:
    #   exec:
    #     command:
    #       - /bin/sh
    #       - -c
    #       - sleep 15

# =============================================================================
# Service Configuration
# @section -- Service Configuration
# =============================================================================

service:
  # -- Service type
  type: ClusterIP

  # -- Service port
  port: 5540

  # -- Service target port (container port)
  targetPort: 5540

  # -- Node port (only used if type is NodePort)
  nodePort: ""

  # -- Load balancer IP (only used if type is LoadBalancer)
  loadBalancerIP: ""

  # -- Load balancer source ranges (only used if type is LoadBalancer)
  loadBalancerSourceRanges: []

  # -- External traffic policy (only used if type is LoadBalancer or NodePort)
  externalTrafficPolicy: ""

  # -- Cluster IP (set to None for headless service)
  clusterIP: ""

  # -- Session affinity
  sessionAffinity: None

  # -- Session affinity config
  sessionAffinityConfig: {}

  # -- Service annotations
  annotations: {}

  # -- Service labels
  labels: {}

# =============================================================================
# Ingress Configuration
# @section -- Ingress Configuration
# =============================================================================

ingress:
  # -- Enable ingress
  enabled: false

  # -- Ingress class name
  className: ""

  # -- Ingress annotations
  # Example for nginx ingress:
  # annotations:
  #   cert-manager.io/cluster-issuer: "letsencrypt-prod"
  #   nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
  annotations: {}

  # -- Ingress hosts configuration
  # Example:
  # hosts:
  #   - host: redisinsight.example.com
  #     paths:
  #       - path: /
  #         pathType: Prefix
  hosts: []

  # -- Ingress TLS configuration
  # Example:
  # tls:
  #   - secretName: redisinsight-tls
  #     hosts:
  #       - redisinsight.example.com
  tls: []

# =============================================================================
# Persistence Configuration
# @section -- Persistence Configuration
# =============================================================================

persistence:
  # -- Enable persistent storage for Redis Insight data
  # Data includes connections, preferences, and history
  enabled: false

  # -- Storage class name
  # @default -- Default storage class
  storageClassName: ""

  # -- Access mode for the persistent volume
  accessMode: ReadWriteOnce

  # -- Size of the persistent volume
  size: 1Gi

  # -- Name of an existing PVC to use
  existingClaim: ""

  # -- Annotations for the PVC
  annotations: {}

# =============================================================================
# Security Context
# @section -- Security Context
# =============================================================================

# -- Pod security context
# Redis Insight runs as user 1000 by default
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000
  fsGroupChangePolicy: "OnRootMismatch"
  seccompProfile:
    type: RuntimeDefault

# -- Container security context
securityContext:
  allowPrivilegeEscalation: false
  runAsNonRoot: true
  runAsUser: 1000
  readOnlyRootFilesystem: false
  capabilities:
    drop:
      - ALL

# =============================================================================
# Resources
# @section -- Resources
# =============================================================================

# -- Resource limits and requests
resources:
  limits:
    cpu: 1000m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 256Mi

# =============================================================================
# Probes
# @section -- Health Probes
# =============================================================================

# -- Liveness probe configuration
livenessProbe:
  enabled: true
  httpGet:
    path: /api/health/
    port: http
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6
  successThreshold: 1

# -- Readiness probe configuration
readinessProbe:
  enabled: true
  httpGet:
    path: /api/health/
    port: http
  initialDelaySeconds: 15
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 3
  successThreshold: 1

# -- Startup probe configuration
startupProbe:
  enabled: true
  httpGet:
    path: /api/health/
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 3
  failureThreshold: 30
  successThreshold: 1

# =============================================================================
# Pod Configuration
# @section -- Pod Configuration
# =============================================================================

# -- Pod annotations
podAnnotations: {}

# -- Pod labels
podLabels: {}

# -- Node selector for pod assignment
nodeSelector: {}

# -- Tolerations for pod assignment
tolerations: []

# -- Affinity for pod assignment
affinity: {}

# -- Priority class name for the pod
priorityClassName: ""

# -- Topology spread constraints for pod distribution
topologySpreadConstraints: []
  # - maxSkew: 1
  #   topologyKey: topology.kubernetes.io/zone
  #   whenUnsatisfiable: ScheduleAnyway
  #   labelSelector:
  #     matchLabels:
  #       app.kubernetes.io/name: redisinsight

# -- DNS policy
dnsPolicy: ClusterFirst

# -- DNS config
dnsConfig: {}

# -- Host aliases
hostAliases: []

# -- Runtime class name
runtimeClassName: ""

# -- Init containers to run before the main container
initContainers: []
  # - name: init-permissions
  #   image: busybox:latest
  #   command: ['sh', '-c', 'chown -R 1000:1000 /data']
  #   volumeMounts:
  #     - name: redisinsight-data
  #       mountPath: /data

# -- Extra sidecar containers
extraContainers: []

# -- Extra environment variables
extraEnv: []
  # - name: CUSTOM_VAR
  #   value: "custom-value"

# -- Extra environment variables from ConfigMaps or Secrets
extraEnvFrom: []

# -- Extra volumes
extraVolumes: []

# -- Extra volume mounts
extraVolumeMounts: []

# =============================================================================
# Monitoring
# @section -- Monitoring
# =============================================================================

monitoring:
  serviceMonitor:
    # -- Enable ServiceMonitor for Prometheus Operator
    enabled: false

    # -- Namespace for the ServiceMonitor (defaults to the release namespace)
    namespace: ""

    # -- Interval at which metrics should be scraped
    interval: 30s

    # -- Timeout for scraping metrics
    scrapeTimeout: 10s

    # -- Additional labels for the ServiceMonitor
    labels: {}

    # -- Additional annotations for the ServiceMonitor
    annotations: {}

    # -- Metric relabelings
    metricRelabelings: []

    # -- Relabelings
    relabelings: []

  prometheusRule:
    # -- Enable PrometheusRule for alerting
    enabled: false

    # -- Namespace for the PrometheusRule (defaults to the release namespace)
    namespace: ""

    # -- Additional labels for the PrometheusRule
    labels: {}

    # -- Alert rules
    rules: []
      # - alert: RedisInsightDown
      #   expr: up{job="redisinsight"} == 0
      #   for: 5m
      #   labels:
      #     severity: critical
      #   annotations:
      #     summary: "Redis Insight is down"
      #     description: "Redis Insight instance {{ $labels.instance }} is down"

# =============================================================================
# High Availability
# @section -- High Availability
# =============================================================================

pdb:
  # -- Enable PodDisruptionBudget
  enabled: false

  # -- Minimum number of pods that must be available
  minAvailable: 1

  # -- Maximum number of pods that can be unavailable
  maxUnavailable: ""

# -- Horizontal Pod Autoscaler configuration
hpa:
  # -- Enable HorizontalPodAutoscaler
  enabled: false

  # -- Minimum number of replicas
  minReplicas: 1

  # -- Maximum number of replicas
  maxReplicas: 3

  # -- Target CPU utilization percentage
  targetCPUUtilizationPercentage: 80

  # -- Target memory utilization percentage
  targetMemoryUtilizationPercentage: 80

  # -- Custom metrics for autoscaling
  customMetrics: []

# =============================================================================
# RBAC Configuration
# @section -- RBAC Configuration
# =============================================================================

serviceAccount:
  # -- Create a service account
  create: true

  # -- Service account name (generated if not set and create is true)
  name: ""

  # -- Service account annotations
  annotations: {}

rbac:
  # -- Create RBAC resources
  create: true

  # -- Additional RBAC rules
  rules: []

# =============================================================================
# Network Policy
# @section -- Network Policy
# =============================================================================

networkPolicy:
  # -- Enable network policy
  enabled: false

  # -- Policy types
  policyTypes:
    - Ingress
    - Egress

  # -- Ingress rules
  ingress: []

  # -- Egress rules
  # By default, allow egress to Redis port
  egress:
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 6379
    # Allow DNS
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: UDP
          port: 53

# =============================================================================
# Diagnostic Mode
# @section -- Diagnostic Mode
# =============================================================================

diagnosticMode:
  # -- Enable diagnostic mode (disables probes, overrides command)
  enabled: false

  # -- Command override for diagnostic mode
  command:
    - sleep

  # -- Args override for diagnostic mode
  args:
    - infinity
