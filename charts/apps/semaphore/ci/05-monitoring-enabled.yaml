# CI Test: Monitoring enabled
# Tests ServiceMonitor, PrometheusRule, and HPA

semaphore:
  database:
    dialect: sqlite
  admin:
    username: admin
    password: testpass123
    email: admin@example.com

controller:
  type: deployment
  replicas: 2

service:
  type: ClusterIP

persistence:
  data:
    enabled: true
    size: 2Gi
  config:
    enabled: true
    size: 512Mi
  tmp:
    enabled: true
    size: 5Gi

monitoring:
  serviceMonitor:
    enabled: true
    interval: 30s
    scrapeTimeout: 10s
    labels:
      prometheus: kube-prometheus

  prometheusRule:
    enabled: true
    labels:
      prometheus: kube-prometheus
    rules:
      - alert: SemaphoreHighMemory
        expr: |
          container_memory_working_set_bytes{pod=~"semaphore-.*"} /
          container_spec_memory_limit_bytes{pod=~"semaphore-.*"} > 0.85
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "Semaphore high memory usage"

pdb:
  enabled: true
  minAvailable: 1

hpa:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 250m
    memory: 512Mi
