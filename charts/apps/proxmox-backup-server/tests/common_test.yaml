suite: test pbs common labels and metadata
templates:
  - deployment.yaml
  - service.yaml
  - secret.yaml
  - configmap.yaml
tests:
  - it: should add common labels to deployment
    template: deployment.yaml
    set:
      pbs.email: admin@example.com
      pbs.password: test123
    asserts:
      - isKind:
          of: Deployment
      - equal:
          path: metadata.labels["app.kubernetes.io/name"]
          value: pbs
      - equal:
          path: metadata.labels["app.kubernetes.io/instance"]
          value: RELEASE-NAME
      - equal:
          path: metadata.labels["app.kubernetes.io/version"]
          value: "8.12"

  - it: should add additional labels
    template: deployment.yaml
    set:
      pbs.email: admin@example.com
      pbs.password: test123
      additionalLabels:
        environment: production
        team: database-ops
    asserts:
      - equal:
          path: metadata.labels.environment
          value: production
      - equal:
          path: metadata.labels.team
          value: database-ops

  - it: should override namespace
    template: service.yaml
    set:
      namespaceOverride: "custom-namespace"
    asserts:
      - equal:
          path: metadata.namespace
          value: custom-namespace

  - it: should use custom name overrides
    template: deployment.yaml
    set:
      pbs.email: admin@example.com
      pbs.password: test123
      nameOverride: "my-pbs"
    asserts:
      - matchRegex:
          path: metadata.name
          pattern: "my-pbs$"

  - it: should use fullname override
    template: deployment.yaml
    set:
      pbs.email: admin@example.com
      pbs.password: test123
      fullnameOverride: "custom-pbs"
    asserts:
      - equal:
          path: metadata.name
          value: custom-pbs
