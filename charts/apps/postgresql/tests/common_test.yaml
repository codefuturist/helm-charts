suite: test postgresql labels and common
templates:
  - deployment.yaml
  - service.yaml
  - secret.yaml
tests:
  - it: should add common labels
    template: deployment.yaml
    set:
      statefulset.enabled: false
    asserts:
      - equal:
          path: metadata.labels["app.kubernetes.io/name"]
          value: postgresql
      - equal:
          path: metadata.labels["app.kubernetes.io/instance"]
          value: RELEASE-NAME
      - equal:
          path: metadata.labels["app.kubernetes.io/component"]
          value: database

  - it: should add additional labels
    template: deployment.yaml
    set:
      statefulset.enabled: false
      additionalLabels:
        environment: production
        team: platform
    asserts:
      - equal:
          path: metadata.labels.environment
          value: production
      - equal:
          path: metadata.labels.team
          value: platform

  - it: should override namespace
    template: service.yaml
    set:
      namespaceOverride: "custom-namespace"
    asserts:
      - equal:
          path: metadata.namespace
          value: custom-namespace

  - it: should use custom application name
    template: deployment.yaml
    set:
      statefulset.enabled: false
      applicationName: "my-postgres"
    asserts:
      - matchRegex:
          path: metadata.name
          pattern: "my-postgres$"
