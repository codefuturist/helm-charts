# Test installation with user and database management
postgresql:
  database: "postgres"
  username: "postgres"

  # Enable extensions
  extensions:
    - pg_stat_statements
    - pgcrypto
    - uuid-ossp

  # Create additional databases
  additionalDatabases:
    - name: myapp_db
      owner: myapp_user
      encoding: UTF8
      lc_collate: en_US.UTF-8
      lc_ctype: en_US.UTF-8
      template: template0

    - name: analytics_db
      owner: postgres
      encoding: UTF8

    - name: staging_db
      owner: myapp_user
      encoding: UTF8

  # Create additional users
  additionalUsers:
    - username: myapp_user
      existingSecret: myapp-user-secret
      databases:
        - myapp_db
        - staging_db
      privileges: ALL
      superuser: false
      createdb: false
      createrole: false
      replication: false

    - username: readonly_user
      existingSecret: readonly-user-secret
      databases:
        - myapp_db
        - analytics_db
        - staging_db
      privileges: SELECT
      superuser: false
      createdb: false
      createrole: false
      replication: false

# Small resources for testing
deployment:
  replicas: 1
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  # Override affinity to avoid template value issues
  affinity: {}

  # Override topology spread constraints
  topologySpreadConstraints: []

# Use small persistence for testing
persistence:
  enabled: true
  size: 1Gi
  storageClass: "" # Use default storage class

# Disable features we don't need for this test
backup:
  enabled: false

metrics:
  enabled: false

monitoring:
  serviceMonitor:
    enabled: false
  prometheusRule:
    enabled: false

replication:
  enabled: false

statefulset:
  enabled: false
