suite: test redisinsight secrets
templates:
  - secret.yaml
tests:
  - it: should create secret with inline credentials
    set:
      redisinsight.email: admin@example.com
      redisinsight.password: test123
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: metadata.name
          value: RELEASE-NAME-redisinsight
      - equal:
          path: type
          value: Opaque
      - isNotEmpty:
          path: data.email
      - isNotEmpty:
          path: data.password

  - it: should not create secret when using existing secret
    set:
      redisinsight.existingSecret: "my-secret"
    asserts:
      - hasDocuments:
          count: 0

  - it: should create SMTP secret when enabled
    set:
      redisinsight.email: admin@example.com
      redisinsight.password: test123
      redisinsight.smtp.enabled: true
      redisinsight.smtp.username: smtp@example.com
      redisinsight.smtp.password: smtppass123
    asserts:
      - hasDocuments:
          count: 2

  - it: should create pgpass secret when enabled
    set:
      redisinsight.email: admin@example.com
      redisinsight.password: test123
      redisinsight.pgpassFile.enabled: true
      redisinsight.pgpassFile.existingSecret: ""
      redisinsight.pgpassFile.content: "localhost:5432:*:postgres:password"
    asserts:
      - hasDocuments:
          count: 2
