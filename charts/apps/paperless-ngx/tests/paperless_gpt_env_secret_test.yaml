suite: paperless-gpt-env-secret
templates:
  - paperless-gpt-env-secret.yaml
tests:
  - it: creates managed env secret when enabled
    set:
      paperlessGpt.enabled: true
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: metadata.name
          value: RELEASE-NAME-paperless-ngx-paperless-gpt-env
      - matchRegex:
          path: stringData["paperless-gpt.env"]
          pattern: "PAPERLESS_API_URL=http://RELEASE-NAME-paperless-ngx:80/api"

  - it: skips env secret when existing secret provided
    set:
      paperlessGpt.enabled: true
      paperlessGpt.envSecret.existingSecret: custom-gpt-env
    asserts:
      - hasDocuments:
          count: 0

  - it: skips env secret in ui mode
    set:
      paperlessGpt.enabled: true
      paperlessGpt.configMode: ui
    asserts:
      - hasDocuments:
          count: 0
