# Pi-hole deployment with existing Kubernetes secret
# This demonstrates secure secret management

# Use existing secret instead of creating one
secret:
  enabled: false
  existingSecret: "pihole-secrets"

# ServiceAccount for proper RBAC
serviceAccount:
  enabled: true

deployment:
  replicas: 1

  # Production resource limits
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m

  # Use emptyDir for testing (use PVCs in production)
  volumes:
    - name: etc-pihole
      type: emptyDir
      mountPath: /etc/pihole
      readOnly: false
    - name: etc-dnsmasq-d
      type: emptyDir
      mountPath: /etc/dnsmasq.d
      readOnly: false

  # Environment variables - reference the secret
  env:
    TZ:
      value: "America/New_York"

    # SECURE: Reference password from Kubernetes secret
    FTLCONF_webserver_api_password:
      valueFrom:
        secretKeyRef:
          name: pihole-secrets # Reference the existing secret
          key: FTLCONF_webserver_api_password

    # Other Pi-hole configuration
    FTLCONF_dns_listeningMode:
      value: all
    FTLCONF_dns_upstreams:
      value: 8.8.8.8;8.8.4.4;1.1.1.1
    FTLCONF_dns_dnssec:
      value: "true"
    FTLCONF_database_DBfile:
      value: /etc/pihole/pihole-FTL.db
    FTLCONF_webserver_port:
      value: 80o,[::]:80o,443os,[::]:443os
    PIHOLE_UID:
      value: "1000"
    PIHOLE_GID:
      value: "1000"

# Service configuration
service:
  type: ClusterIP
  port: 80

# Optional: Enable monitoring
serviceMonitor:
  enabled: false

# Optional: Enable high availability
podDisruptionBudget:
  enabled: false
