# Example: Using existing Kubernetes secret with Pi-hole
# This is the RECOMMENDED approach for production deployments

# First, create a secret manually:
# kubectl create secret generic pihole-secrets \
#   --from-literal=WEBPASSWORD='my-secure-web-password' \
#   --from-literal=FTLCONF_webserver_api_password='my-secure-api-password'

# Or from a file:
# kubectl create secret generic pihole-secrets \
#   --from-file=WEBPASSWORD=./webpassword.txt \
#   --from-file=FTLCONF_webserver_api_password=./apipassword.txt

# Then install the chart referencing the existing secret:
secret:
  # Don't create a new secret
  enabled: false

  # Reference the existing secret
  existingSecret: "pihole-secrets"

  # Specify which keys to use (optional - defaults shown)
  existingSecretKeys:
    webPassword: "WEBPASSWORD"
    apiPassword: "FTLCONF_webserver_api_password"

deployment:
  replicas: 2

  # Use secrets for sensitive environment variables
  env:
    TZ:
      value: "America/New_York"

    # Reference the secret for the password
    FTLCONF_webserver_api_password:
      valueFrom:
        secretKeyRef:
          name: pihole-secrets # Must match secret.existingSecret
          key: FTLCONF_webserver_api_password

    # Other non-sensitive config
    FTLCONF_dns_listeningMode:
      value: all
    FTLCONF_dns_upstreams:
      value: 8.8.8.8;8.8.4.4;1.1.1.1

  # Use emptyDir or PVCs for storage
  volumes:
    - name: etc-pihole
      type: emptyDir
      mountPath: /etc/pihole
      readOnly: false
    - name: etc-dnsmasq-d
      type: emptyDir
      mountPath: /etc/dnsmasq.d
      readOnly: false

service:
  type: ClusterIP
  port: 80

---
# Additional security best practices:

# 1. Use RBAC to restrict secret access
# 2. Enable encryption at rest for secrets in etcd
# 3. Use Pod Security Standards to prevent privilege escalation
# 4. Rotate secrets regularly
# 5. Never commit secrets to version control
# 6. Use different secrets for different environments
# 7. Consider using a secret management solution (see other examples)
