suite: test postgresql configmap
templates:
  - configmap.yaml
tests:
  - it: should create configmap with postgresql.conf
    asserts:
      - isKind:
          of: ConfigMap
      - equal:
          path: metadata.name
          value: RELEASE-NAME-postgresql-config
      - exists:
          path: data["postgresql.conf"]

  - it: should include custom configuration
    set:
      postgresql.config.max_connections: "500"
    asserts:
      - matchRegex:
          path: data["postgresql.conf"]
          pattern: "max_connections = '500'"

  - it: should create init scripts configmap when defined
    set:
      postgresql.initScripts:
        init.sql: "CREATE TABLE test (id INT);"
    asserts:
      - hasDocuments:
          count: 2
