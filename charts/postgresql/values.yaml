# -- (string) Override the namespace for all resources.
# @section -- Global Parameters
namespaceOverride: ""

# -- (string) Override the component label for all resources.
# @section -- Global Parameters
componentOverride: ""

# -- (string) Override the partOf label for all resources.
# @section -- Global Parameters
partOfOverride: ""

# -- (string) Application name.
# @default -- `{{ .Chart.Name }}`
# @section -- Global Parameters
applicationName: ""

# -- (tpl/object) Additional labels for all resources.
# @section -- Global Parameters
additionalLabels: {}
  # example.com/organization: organization-name
  # example.com/team: team-name
  # example.com/owner: owner-name

# -- (tpl/object) Additional annotations for all resources.
# @section -- Global Parameters
additionalAnnotations: {}

# -- (object) Diagnostic mode configuration
# @section -- Global Parameters
diagnosticMode:
  # -- (bool) Enable diagnostic mode (disables probes, overrides command)
  # Useful for debugging container startup issues
  enabled: false

  # -- (array) Command override for diagnostic mode
  command:
    - sleep

  # -- (array) Args override for diagnostic mode
  args:
    - infinity

# =====================================================================
# PostgreSQL Configuration
# =====================================================================

postgresql:
  # -- (string) PostgreSQL version/image tag
  # @section -- PostgreSQL Parameters
  version: "16.4"

  # -- (string) PostgreSQL image repository
  # @section -- PostgreSQL Parameters
  image:
    repository: postgres
    tag: "16.4-alpine"
    pullPolicy: IfNotPresent
    digest: ""

  # -- (object) Image pull secrets
  # @section -- PostgreSQL Parameters
  imagePullSecrets: []
    # - name: registry-secret

  # -- (string) PostgreSQL database name
  # @section -- PostgreSQL Parameters
  database: "postgres"

  # -- (string) PostgreSQL username
  # @section -- PostgreSQL Parameters
  username: "postgres"

  # -- (string) PostgreSQL password (if not using existingSecret)
  # @section -- PostgreSQL Parameters
  password: ""

  # -- (string) PostgreSQL host authentication method
  # @section -- PostgreSQL Parameters
  # Options: scram-sha-256, md5, password, trust
  hostAuthMethod: "scram-sha-256"

  # -- (string) Reference to existing secret containing PostgreSQL password
  # @section -- PostgreSQL Parameters
  existingSecret: ""

  # -- (string) Key in existing secret containing the password
  # @section -- PostgreSQL Parameters
  existingSecretPasswordKey: "postgresql-password"

  # -- (string) PostgreSQL postgres user password (superuser)
  # @section -- PostgreSQL Parameters
  postgresPassword: ""

  # -- (string) Reference to existing secret containing postgres password
  # @section -- PostgreSQL Parameters
  existingPostgresSecret: ""

  # -- (string) Key in existing secret containing the postgres password
  # @section -- PostgreSQL Parameters
  existingPostgresPasswordKey: "postgresql-postgres-password"

  # -- (object) Password security configuration
  # @section -- PostgreSQL Parameters
  auth:
    # -- (bool) Use password files instead of environment variables (more secure)
    # When enabled, passwords are mounted as files from secrets instead of being exposed as env vars
    # This prevents password exposure in process lists and kubectl describe output
    usePasswordFiles: true

    # -- (string) Path where password files will be mounted
    passwordFilesPath: "/opt/bitnami/postgresql/secrets"

  # -- (object) Pre-initialization scripts (run BEFORE database initialization)
  # @section -- PostgreSQL Parameters
  preInitScripts: {}
    # 00-setup-permissions.sh: |
    #   #!/bin/bash
    #   echo "Setting up filesystem permissions..."
    #   chmod 700 /var/lib/postgresql/data
    # 01-install-extensions.sh: |
    #   #!/bin/bash
    #   echo "Installing system-level requirements..."

  # -- (object) PostgreSQL configuration parameters
  # @section -- PostgreSQL Parameters
  # IMPORTANT: For dynamic user sync (CronJob) or external connections, set listen_addresses: "*"
  config:
    # Network - REQUIRED for dynamic user management
    # listen_addresses: "*"  # Uncomment to allow network connections (required for CronJob sync)
    # Performance tuning
    max_connections: "100"
    shared_buffers: "256MB"
    effective_cache_size: "1GB"
    maintenance_work_mem: "64MB"
    checkpoint_completion_target: "0.9"
    wal_buffers: "16MB"
    default_statistics_target: "100"
    random_page_cost: "1.1"
    effective_io_concurrency: "200"
    work_mem: "2621kB"
    huge_pages: "try"
    min_wal_size: "1GB"
    max_wal_size: "4GB"
    max_worker_processes: "4"
    max_parallel_workers_per_gather: "2"
    max_parallel_workers: "4"
    max_parallel_maintenance_workers: "2"

    # Logging
    log_destination: "stderr"
    logging_collector: "off"
    log_min_duration_statement: "1000"
    log_checkpoints: "on"
    log_connections: "on"
    log_disconnections: "on"
    log_lock_waits: "on"
    log_temp_files: "0"
    log_autovacuum_min_duration: "0"
    log_error_verbosity: "default"
    log_line_prefix: "%m [%p] %q%u@%d "

    # Replication
    wal_level: "replica"
    max_wal_senders: "10"
    max_replication_slots: "10"
    hot_standby: "on"
    hot_standby_feedback: "on"

    # Security
    ssl: "off"
    password_encryption: "scram-sha-256"

  # -- (string) Custom PostgreSQL configuration (postgresql.conf)
  # @section -- PostgreSQL Parameters
  customConfig: ""

  # -- (string) Custom pg_hba.conf configuration
  # @section -- PostgreSQL Parameters
  customPgHba: ""

  # -- (array) PostgreSQL extensions to enable
  # @section -- PostgreSQL Parameters
  extensions:
    - pg_stat_statements
    - pgcrypto
    # - uuid-ossp
    # - pgaudit
    # - pg_trgm
    # - btree_gin
    # - btree_gist

  # -- (array) Init scripts to run on first boot
  # @section -- PostgreSQL Parameters
  initScripts: {}
    # init-db.sql: |
    #   CREATE EXTENSION IF NOT EXISTS pg_stat_statements;
    #   CREATE EXTENSION IF NOT EXISTS pgcrypto;

  # -- (array) Additional databases to create on first boot
  # @section -- PostgreSQL Parameters
  additionalDatabases: []
    # - name: myapp_db
    #   owner: myapp_user
    #   encoding: UTF8
    #   lc_collate: en_US.UTF-8
    #   lc_ctype: en_US.UTF-8
    #   template: template0
    # - name: analytics_db
    #   owner: postgres

  # -- (array) Additional users to create on first boot
  # @section -- PostgreSQL Parameters
  additionalUsers: []
    # - username: myapp_user
    #   password: mysecretpass  # Not recommended, use existingSecret instead
    #   existingSecret: myapp-user-secret  # Recommended: reference a k8s secret
    #   existingSecretKey: password  # Key in the secret, defaults to 'password'
    #   databases:  # Databases to grant access to
    #     - myapp_db
    #   privileges: ALL  # Privileges to grant: ALL, SELECT, INSERT, UPDATE, DELETE, etc.
    #   superuser: false
    #   createdb: false
    #   createrole: false
    #   replication: false
    # - username: readonly_user
    #   existingSecret: readonly-user-secret
    #   databases:
    #     - myapp_db
    #     - analytics_db
    #   privileges: SELECT

  # -- (object) External Kubernetes resources to read databases/users from
  # @section -- PostgreSQL Parameters
  externalResources:
    # -- (bool) Enable reading from external ConfigMaps/Secrets
    enabled: false
    # -- (object) ConfigMap containing database definitions
    databasesConfigMap:
      name: ""
      namespace: ""
      key: "databases.yaml" # Should contain YAML array of databases
    # -- (object) ConfigMap containing user definitions
    usersConfigMap:
      name: ""
      namespace: ""
      key: "users.yaml" # Should contain YAML array of users
    # -- (object) Secret containing user passwords
    usersSecret:
      name: ""
      namespace: ""
      # Map of username to secret key
      passwordKeys: {}
        # myapp_user: password
        # readonly_user: password

  # -- (array) Additional environment variables
  # @section -- PostgreSQL Parameters
  env: []
    # - name: PGDATA
    #   value: /var/lib/postgresql/data/pgdata
    # - name: TZ
    #   value: UTC

  # -- (object) Additional environment variables from secrets or configmaps
  # @section -- PostgreSQL Parameters
  envFrom: []
    # - secretRef:
    #     name: postgres-env-secret
    # - configMapRef:
    #     name: postgres-env-config

# =====================================================================
# Deployment Configuration
# =====================================================================

deployment:
  # -- (int) Number of PostgreSQL replicas
  # @section -- Deployment Parameters
  replicas: 1

  # -- (string) Deployment strategy
  # @section -- Deployment Parameters
  strategy:
    type: Recreate

  # -- (object) Pod annotations
  # @section -- Deployment Parameters
  podAnnotations:
    # Prometheus scraping
    prometheus.io/scrape: "false"
    prometheus.io/port: "9187"
    prometheus.io/path: "/metrics"
    # ConfigMap/Secret change detection (for tools like Reloader)
    configmap.reloader.stakater.com/reload: "postgresql-config"
    secret.reloader.stakater.com/reload: "postgresql"

  # -- (object) Pod labels
  # @section -- Deployment Parameters
  podLabels:
    # Useful for network policies and service mesh
    app.kubernetes.io/component: database
    app.kubernetes.io/part-of: postgresql

  # -- (object) Security context for the pod
  # @section -- Deployment Parameters
  podSecurityContext:
    fsGroup: 999
    fsGroupChangePolicy: "OnRootMismatch"

  # -- (object) Security context for the container
  # @section -- Deployment Parameters
  securityContext:
    runAsUser: 999
    runAsGroup: 999
    runAsNonRoot: true
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: false
    capabilities:
      drop:
        - ALL

  # -- (object) Resource limits and requests
  # @section -- Deployment Parameters
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 256Mi

  # -- (object) Liveness probe configuration
  # @section -- Deployment Parameters
  livenessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1
    exec:
      command:
        - /bin/sh
        - -c
        - exec pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB} -q

  # -- (object) Readiness probe configuration
  # @section -- Deployment Parameters
  readinessProbe:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
    successThreshold: 1
    exec:
      command:
        - /bin/sh
        - -c
        - exec pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB} -q

  # -- (object) Startup probe configuration
  # @section -- Deployment Parameters
  startupProbe:
    enabled: true
    initialDelaySeconds: 0
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
    successThreshold: 1
    exec:
      command:
        - /bin/sh
        - -c
        - exec pg_isready -U ${POSTGRES_USER} -d ${POSTGRES_DB} -q

  # -- (object) Node selector
  # @section -- Deployment Parameters
  nodeSelector: {}

  # -- (array) Tolerations
  # @section -- Deployment Parameters
  tolerations: []

  # -- (object) Affinity rules
  # @section -- Deployment Parameters
  affinity: {}
    # podAntiAffinity:
    #   preferredDuringSchedulingIgnoredDuringExecution:
    #     - weight: 100
    #       podAffinityTerm:
    #         labelSelector:
    #           matchLabels:
    #             app.kubernetes.io/name: postgresql
    #             app.kubernetes.io/instance: RELEASE-NAME
    #         topologyKey: kubernetes.io/hostname

  # -- (string) Priority class name
  # @section -- Deployment Parameters
  priorityClassName: ""

  # -- (string) Service account name
  # @section -- Deployment Parameters
  serviceAccountName: ""

  # -- (int) Termination grace period
  # @section -- Deployment Parameters
  terminationGracePeriodSeconds: 30

  # -- (array) Topology spread constraints
  # @section -- Deployment Parameters
  topologySpreadConstraints: []
    # - maxSkew: 1
    #   topologyKey: topology.kubernetes.io/zone
    #   whenUnsatisfiable: ScheduleAnyway
    #   labelSelector:
    #     matchLabels:
    #       app.kubernetes.io/name: postgresql
    #       app.kubernetes.io/instance: RELEASE-NAME

  # -- (string) DNS policy
  # @section -- Deployment Parameters
  dnsPolicy: ClusterFirst

  # -- (object) DNS config
  # @section -- Deployment Parameters
  dnsConfig: {}

  # -- (array) Host aliases
  # @section -- Deployment Parameters
  hostAliases: []

  # -- (array) Init containers
  # @section -- Deployment Parameters
  initContainers: []
    # - name: init-chmod
    #   image: busybox:latest
    #   command: ['sh', '-c', 'chown -R 999:999 /var/lib/postgresql/data']
    #   volumeMounts:
    #     - name: data
    #       mountPath: /var/lib/postgresql/data

  # -- (array) Sidecar containers
  # @section -- Deployment Parameters
  sidecarContainers: []
    # - name: postgres-exporter
    #   image: quay.io/prometheuscommunity/postgres-exporter:latest
    #   env:
    #     - name: DATA_SOURCE_NAME
    #       value: "postgresql://postgres:password@localhost:5432/postgres?sslmode=disable"
    #   ports:
    #     - containerPort: 9187
    #       name: metrics

  # -- (object) Lifecycle hooks for graceful shutdown
  # @section -- Deployment Parameters
  lifecycle:
    preStop:
      exec:
        command:
          - /bin/sh
          - -c
          - |
            # Wait for active connections to close gracefully
            pg_ctl stop -D ${PGDATA} -m smart -t 60 || pg_ctl stop -D ${PGDATA} -m fast -t 30

# =====================================================================
# StatefulSet Configuration (for replication)
# =====================================================================

statefulset:
  # -- (bool) Use StatefulSet instead of Deployment
  # @section -- StatefulSet Parameters
  enabled: false

  # -- (string) Service name for StatefulSet
  # @section -- StatefulSet Parameters
  serviceName: postgresql

  # -- (string) Pod management policy
  # @section -- StatefulSet Parameters
  podManagementPolicy: OrderedReady

  # -- (object) Update strategy
  # @section -- StatefulSet Parameters
  updateStrategy:
    type: RollingUpdate

# =====================================================================
# Persistence Configuration
# =====================================================================

persistence:
  # -- (bool) Enable persistence using PVC
  # @section -- Persistence Parameters
  enabled: true

  # -- (string) Use existing PVC
  # @section -- Persistence Parameters
  existingClaim: ""

  # -- (string) Storage class name
  # @section -- Persistence Parameters
  storageClass: ""

  # -- (array) Access modes
  # @section -- Persistence Parameters
  accessModes:
    - ReadWriteOnce

  # -- (string) Size of the volume
  # @section -- Persistence Parameters
  size: 2Gi

  # -- (object) Annotations for PVC
  # @section -- Persistence Parameters
  annotations: {}

  # -- (object) Selector for PVC
  # @section -- Persistence Parameters
  selector: {}

  # -- (string) Mount path for data
  # @section -- Persistence Parameters
  mountPath: /var/lib/postgresql/data

  # -- (string) Sub path inside the volume
  # @section -- Persistence Parameters
  subPath: ""

  # -- (object) PVC retention policy (requires Kubernetes 1.23+)
  # @section -- Persistence Parameters
  retentionPolicy:
    # -- (bool) Enable PVC retention policy
    enabled: false

    # -- (string) Volume retention behavior when the replica count is reduced
    # Options: Retain (keep PVCs), Delete (remove PVCs)
    whenScaled: Retain

    # -- (string) Volume retention behavior when the StatefulSet is deleted
    # Options: Retain (keep PVCs), Delete (remove PVCs)
    whenDeleted: Retain

# =====================================================================
# Service Configuration
# =====================================================================

service:
  # -- (bool) Enable service
  # @section -- Service Parameters
  enabled: true

  # -- (string) Service type
  # @section -- Service Parameters
  type: ClusterIP

  # -- (int) PostgreSQL service port
  # @section -- Service Parameters
  port: 5432

  # -- (int) PostgreSQL container port
  # @section -- Service Parameters
  targetPort: 5432

  # -- (int) Node port (if service type is NodePort)
  # @section -- Service Parameters
  nodePort: ""

  # -- (string) Load balancer IP (if service type is LoadBalancer)
  # @section -- Service Parameters
  loadBalancerIP: ""

  # -- (array) Load balancer source ranges
  # @section -- Service Parameters
  loadBalancerSourceRanges: []

  # -- (string) External traffic policy
  # @section -- Service Parameters
  externalTrafficPolicy: ""

  # -- (string) Cluster IP
  # @section -- Service Parameters
  clusterIP: ""

  # -- (object) Service annotations
  # @section -- Service Parameters
  annotations: {}

  # -- (object) Service labels
  # @section -- Service Parameters
  labels: {}

  # -- (string) Session affinity
  # @section -- Service Parameters
  sessionAffinity: None

  # -- (object) Session affinity config
  # @section -- Service Parameters
  sessionAffinityConfig: {}

# =====================================================================
# ServiceAccount Configuration
# =====================================================================

serviceAccount:
  # -- (bool) Create service account
  # @section -- ServiceAccount Parameters
  create: true

  # -- (string) Service account name
  # @section -- ServiceAccount Parameters
  name: ""

  # -- (object) Service account annotations
  # @section -- ServiceAccount Parameters
  annotations: {}

  # -- (bool) Automount service account token
  # @section -- ServiceAccount Parameters
  automountServiceAccountToken: false

# =====================================================================
# RBAC Configuration
# =====================================================================

rbac:
  # -- (bool) Create RBAC resources
  # @section -- RBAC Parameters
  create: false

  # -- (array) Additional rules for the role
  # @section -- RBAC Parameters
  rules: []
    # - apiGroups: [""]
    #   resources: ["pods"]
    #   verbs: ["get", "list"]

# =====================================================================
# Network Policy Configuration
# =====================================================================

networkPolicy:
  # -- (bool) Enable network policy
  # @section -- NetworkPolicy Parameters
  enabled: false

  # -- (array) Ingress rules
  # @section -- NetworkPolicy Parameters
  ingress: []
    # - from:
    #   - namespaceSelector:
    #       matchLabels:
    #         name: my-namespace
    #   ports:
    #   - protocol: TCP
    #     port: 5432

  # -- (array) Egress rules
  # @section -- NetworkPolicy Parameters
  egress: []
    # - to:
    #   - namespaceSelector: {}
    #   ports:
    #   - protocol: TCP
    #     port: 53
    #   - protocol: UDP
    #     port: 53

# =====================================================================
# Pod Disruption Budget Configuration
# =====================================================================

pdb:
  # -- (bool) Enable PodDisruptionBudget
  # @section -- PDB Parameters
  enabled: false

  # -- (int) Minimum available pods
  # @section -- PDB Parameters
  minAvailable: 1

  # -- (string) Maximum unavailable pods
  # @section -- PDB Parameters
  maxUnavailable: ""

# =====================================================================
# Horizontal Pod Autoscaler Configuration
# =====================================================================

hpa:
  # -- (bool) Enable HPA (not recommended for databases)
  # @section -- HPA Parameters
  enabled: false

  # -- (int) Minimum replicas
  # @section -- HPA Parameters
  minReplicas: 1

  # -- (int) Maximum replicas
  # @section -- HPA Parameters
  maxReplicas: 3

  # -- (int) Target CPU utilization percentage
  # @section -- HPA Parameters
  targetCPUUtilizationPercentage: 80

  # -- (int) Target memory utilization percentage
  # @section -- HPA Parameters
  targetMemoryUtilizationPercentage: 80

# =====================================================================
# Vertical Pod Autoscaler Configuration
# =====================================================================

vpa:
  # -- (bool) Enable VPA
  # @section -- VPA Parameters
  enabled: false

  # -- (string) Update mode (Off, Initial, Recreate, Auto)
  # @section -- VPA Parameters
  updateMode: "Auto"

  # -- (object) Resource policy
  # @section -- VPA Parameters
  resourcePolicy: {}

# =====================================================================
# Monitoring Configuration
# =====================================================================

monitoring:
  # -- (bool) Enable monitoring
  # @section -- Monitoring Parameters
  enabled: false

  serviceMonitor:
    # -- (bool) Enable ServiceMonitor for Prometheus Operator
    # @section -- Monitoring Parameters
    enabled: false

    # -- (string) Namespace for ServiceMonitor
    # @section -- Monitoring Parameters
    namespace: ""

    # -- (string) Scrape interval
    # @section -- Monitoring Parameters
    interval: 30s

    # -- (string) Scrape timeout
    # @section -- Monitoring Parameters
    scrapeTimeout: 10s

    # -- (object) Additional labels
    # @section -- Monitoring Parameters
    labels: {}

    # -- (object) Metric relabelings
    # @section -- Monitoring Parameters
    metricRelabelings: []

    # -- (object) Relabelings
    # @section -- Monitoring Parameters
    relabelings: []

  prometheusRule:
    # -- (bool) Enable PrometheusRule for alerts
    # @section -- Monitoring Parameters
    enabled: false

    # -- (string) Namespace for PrometheusRule
    # @section -- Monitoring Parameters
    namespace: ""

    # -- (object) Additional labels
    # @section -- Monitoring Parameters
    labels: {}

    # -- (array) Alert rules
    # @section -- Monitoring Parameters
    rules: []
      # - alert: PostgreSQLDown
      #   expr: pg_up == 0
      #   for: 5m
      #   labels:
      #     severity: critical
      #   annotations:
      #     summary: "PostgreSQL is down"
      #     description: "PostgreSQL instance {{ $labels.instance }} is down"

  grafanaDashboard:
    # -- (bool) Enable Grafana Dashboard ConfigMap
    # @section -- Monitoring Parameters
    enabled: false

    # -- (string) Namespace for Grafana Dashboard
    # @section -- Monitoring Parameters
    namespace: ""

    # -- (object) Additional labels
    # @section -- Monitoring Parameters
    labels:
      grafana_dashboard: "1"

# =====================================================================
# Backup Configuration
# =====================================================================

backup:
  # -- (bool) Enable automated backups
  # @section -- Backup Parameters
  enabled: false

  # -- (string) Backup schedule (cron format)
  # @section -- Backup Parameters
  schedule: "0 2 * * *"

  # -- (int) Number of successful backups to keep
  # @section -- Backup Parameters
  successfulJobsHistoryLimit: 3

  # -- (int) Number of failed backups to keep
  # @section -- Backup Parameters
  failedJobsHistoryLimit: 1

  # -- (object) Backup image configuration
  # @section -- Backup Parameters
  image:
    repository: postgres
    tag: "16.4-alpine"
    pullPolicy: IfNotPresent

  # -- (object) Backup resources
  # @section -- Backup Parameters
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 128Mi

  # -- (object) Backup persistence configuration
  # @section -- Backup Parameters
  persistence:
    enabled: true
    storageClass: ""
    accessModes:
      - ReadWriteOnce
    size: 10Gi
    mountPath: /backups
    annotations: {}

  # -- (object) S3 backup configuration
  # @section -- Backup Parameters
  s3:
    enabled: false
    bucket: ""
    region: "us-east-1"
    endpoint: ""
    accessKeyId: ""
    secretAccessKey: ""
    existingSecret: ""

  # -- (string) Backup retention (days)
  # @section -- Backup Parameters
  retentionDays: 7

  # -- (object) WAL (Write-Ahead Log) archiving for incremental backups
  # @section -- Backup Parameters
  wal:
    # -- (bool) Enable WAL archiving for incremental backups
    enabled: false

    # -- (string) WAL archive method: 'simple' (cp command), 'wal-g', 'wal-e', 'pgbackrest'
    # simple: Copy WAL files to PVC storage
    # wal-g: Modern tool with cloud storage support (recommended)
    # wal-e: Legacy tool with S3 support
    # pgbackrest: Advanced backup and restore tool
    method: "simple"

    # -- (string) Compression for WAL files: 'none', 'gzip', 'lz4', 'zstd'
    compression: "gzip"

    # -- (int) WAL retention period in days
    retentionDays: 14

    # -- (object) WAL archive persistence (used with 'simple' method)
    persistence:
      enabled: true
      storageClass: ""
      accessModes:
        - ReadWriteOnce
      size: 20Gi
      mountPath: /wal-archive
      annotations: {}

    # -- (object) Cloud storage configuration (for wal-g, wal-e, pgbackrest)
    storage:
      # -- (string) Storage type: 's3', 'gcs', 'azure', 'file'
      type: "s3"

      # -- (object) S3 configuration
      s3:
        bucket: ""
        region: "us-east-1"
        endpoint: ""
        prefix: "wal-archive"
        accessKeyId: ""
        secretAccessKey: ""
        existingSecret: ""

      # -- (object) GCS configuration
      gcs:
        bucket: ""
        prefix: "wal-archive"
        credentialsSecret: ""

      # -- (object) Azure configuration
      azure:
        storageAccount: ""
        container: ""
        prefix: "wal-archive"
        existingSecret: ""

    # -- (object) WAL-G specific configuration
    walg:
      # -- (string) WAL-G image
      image:
        repository: wal-g/wal-g
        tag: "v3.0.0"
        pullPolicy: IfNotPresent

      # -- (object) WAL-G resources
      resources:
        limits:
          cpu: 200m
          memory: 256Mi
        requests:
          cpu: 50m
          memory: 64Mi

      # -- (object) Additional environment variables for WAL-G
      env: {}
        # WALG_COMPRESSION_METHOD: "lz4"
        # WALG_DELTA_MAX_STEPS: "6"

    # -- (object) pgBackRest specific configuration
    pgbackrest:
      # -- (string) pgBackRest image
      image:
        repository: pgbackrest/pgbackrest
        tag: "2.49"
        pullPolicy: IfNotPresent

      # -- (object) pgBackRest resources
      resources:
        limits:
          cpu: 200m
          memory: 256Mi
        requests:
          cpu: 50m
          memory: 64Mi

      # -- (object) pgBackRest configuration
      config: {}
        # repo1-retention-full: "2"
        # repo1-retention-diff: "7"

    # -- (string) Archive command override (advanced users)
    # Leave empty to use method-specific default
    archiveCommand: ""

    # -- (string) Restore command override (advanced users)
    # Leave empty to use method-specific default
    restoreCommand: ""

    # -- (object) WAL archiving job schedule (cleanup old WAL files)
    cleanup:
      # -- (bool) Enable WAL cleanup job
      enabled: true

      # -- (string) Cleanup schedule (cron format)
      schedule: "0 3 * * *"

      # -- (int) Number of successful cleanup jobs to keep
      successfulJobsHistoryLimit: 1

      # -- (int) Number of failed cleanup jobs to keep
      failedJobsHistoryLimit: 1

# =====================================================================
# Recovery Configuration
# =====================================================================

recovery:
  # -- (bool) Enable recovery mode
  # WARNING: This will restore from backup on install/upgrade!
  # @section -- Recovery Parameters
  enabled: false

  # -- (string) Recovery mode: 'full' or 'pitr'
  # full: Restore from full backup only
  # pitr: Point-in-Time Recovery using full backup + WAL archives
  # @section -- Recovery Parameters
  mode: "full"

  # -- (string) Recovery source: 'backup' (PVC) or 's3'
  # @section -- Recovery Parameters
  source: "backup"

  # -- (string) Specific backup file to restore (optional)
  # If not specified, uses the latest backup
  # Example: "backup-2024-11-12-02-00-00.sql.gz"
  # @section -- Recovery Parameters
  backupFile: ""

  # -- (string) Target time for PITR (mode: pitr only)
  # Format: 'YYYY-MM-DD HH:MM:SS' (UTC)
  # Example: "2024-11-12 14:30:00"
  # @section -- Recovery Parameters
  targetTime: ""

  # -- (string) Temporary storage size for recovery process
  # Should be >= database size
  # @section -- Recovery Parameters
  tempStorageSize: "50Gi"

  # -- (object) S3 recovery configuration (source: s3)
  # @section -- Recovery Parameters
  s3:
    # -- (string) Specific S3 backup file (optional)
    backupFile: ""

# =====================================================================
# SSL/TLS Configuration
# =====================================================================

tls:
  # -- (bool) Enable TLS
  # @section -- TLS Parameters
  enabled: false

  # -- (string) Certificate secret name
  # @section -- TLS Parameters
  certificateSecret: ""

  # -- (string) Certificate file name in secret
  # @section -- TLS Parameters
  certFile: tls.crt

  # -- (string) Certificate key file name in secret
  # @section -- TLS Parameters
  certKeyFile: tls.key

  # -- (string) CA certificate file name in secret
  # @section -- TLS Parameters
  caCertFile: ca.crt

  # -- (object) Certificate configuration for cert-manager
  # @section -- TLS Parameters
  certificate:
    enabled: false
    issuerRef:
      name: ""
      kind: ClusterIssuer
    dnsNames: []
    duration: "2160h" # 90 days
    renewBefore: "360h" # 15 days

# =====================================================================
# Replication Configuration
# =====================================================================

replication:
  # -- (bool) Enable replication (requires StatefulSet)
  # @section -- Replication Parameters
  enabled: false

  # -- (int) Number of read replicas
  # @section -- Replication Parameters
  readReplicas: 1

  # -- (string) Replication user
  # @section -- Replication Parameters
  user: "replicator"

  # -- (string) Replication password
  # @section -- Replication Parameters
  password: ""

  # -- (string) Existing secret for replication credentials
  # @section -- Replication Parameters
  existingSecret: ""

  # -- (bool) Synchronous commit
  # @section -- Replication Parameters
  synchronousCommit: false

  # -- (int) Number of synchronous replicas
  # @section -- Replication Parameters
  numSynchronousReplicas: 0

  # -- (object) Replication slot configuration
  # @section -- Replication Parameters
  slots:
    # -- (bool) Enable replication slots for reliable streaming
    enabled: true

    # -- (string) Replication slot name prefix
    prefix: "replica"

    # -- (bool) Auto-create replication slots
    autoCreate: true

  # -- (object) Replica configuration
  # @section -- Replication Parameters
  replica:
    # -- (int) Max standby streaming delay in milliseconds
    maxStandbyStreamingDelay: 30000

    # -- (int) Max standby archive delay in milliseconds
    maxStandbyArchiveDelay: 30000

    # -- (bool) Enable hot standby feedback
    hotStandbyFeedback: true

    # -- (int) WAL receiver timeout in milliseconds
    walReceiverTimeout: 60000

    # -- (int) WAL receiver status interval in seconds
    walReceiverStatusInterval: 10

  # -- (object) Primary server configuration
  # @section -- Replication Parameters
  primary:
    # -- (string) Service name for primary server
    # Leave empty to auto-generate based on release name
    serviceName: ""

    # -- (int) Service port for primary server
    servicePort: 5432

    # -- (bool) Create dedicated primary service
    createService: true

  # -- (object) Replica service configuration
  # @section -- Replication Parameters
  replicaService:
    # -- (bool) Create read-only service for replicas
    enabled: true

    # -- (string) Service type
    type: ClusterIP

    # -- (int) Service port
    port: 5432

    # -- (string) Service name suffix
    # Full name will be: <release-name>-postgresql-read
    nameSuffix: "read"

    # -- (object) Service annotations
    annotations: {}

    # -- (object) Service labels
    labels: {}

    # -- (string) Load balancer source ranges
    loadBalancerSourceRanges: []

  # -- (object) Replication monitoring
  # @section -- Replication Parameters
  monitoring:
    # -- (bool) Enable replication lag monitoring
    enabled: true

    # -- (int) Alert threshold for replication lag in MB
    lagThresholdMB: 100

    # -- (int) Alert threshold for replication delay in seconds
    delayThresholdSeconds: 30

  # -- (object) Automatic failover preparation
  # @section -- Replication Parameters
  failover:
    # -- (bool) Enable automatic promotion configuration
    # Configures replicas to be able to promote automatically
    enabled: true

    # -- (bool) Create trigger file for manual promotion
    triggerFileEnabled: false

    # -- (string) Trigger file path
    triggerFilePath: "/tmp/postgresql.trigger"

  # -- (object) Advanced replication settings
  # @section -- Replication Parameters
  advanced:
    # -- (int) Maximum number of replication slots
    maxReplicationSlots: 10

    # -- (int) Maximum WAL senders
    maxWalSenders: 10

    # -- (int) WAL keep size in MB
    walKeepSize: 1024

    # -- (bool) Enable archive mode for replicas
    archiveModeOnReplicas: false

# =====================================================================
# Metrics Exporter Configuration
# =====================================================================

metrics:
  # -- (bool) Enable PostgreSQL metrics exporter
  # @section -- Metrics Parameters
  enabled: false

  # -- (object) Metrics exporter image
  # @section -- Metrics Parameters
  image:
    repository: quay.io/prometheuscommunity/postgres-exporter
    tag: "v0.18.1"
    pullPolicy: IfNotPresent

  # -- (int) Metrics port
  # @section -- Metrics Parameters
  port: 9187

  # -- (object) Metrics exporter resources
  # @section -- Metrics Parameters
  resources:
    limits:
      cpu: 100m
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi

  # -- (object) Custom queries for metrics
  # @section -- Metrics Parameters
  customQueries: {}

# =====================================================================
# PgBouncer Configuration
# =====================================================================

pgbouncer:
  # -- (bool) Enable PgBouncer connection pooler
  # @section -- PgBouncer Parameters
  enabled: false

  # -- (int) Number of PgBouncer replicas
  # @section -- PgBouncer Parameters
  replicas: 1

  # -- (object) PgBouncer image
  # @section -- PgBouncer Parameters
  image:
    repository: edoburu/pgbouncer
    tag: "1.21.0"
    pullPolicy: IfNotPresent

  # -- (int) PgBouncer port
  # @section -- PgBouncer Parameters
  port: 5432

  # -- (object) PgBouncer configuration
  # @section -- PgBouncer Parameters
  config:
    pool_mode: transaction
    max_client_conn: 1000
    default_pool_size: 25
    min_pool_size: 5
    reserve_pool_size: 5
    reserve_pool_timeout: 3
    max_db_connections: 100
    max_user_connections: 100

  # -- (object) PgBouncer resources
  # @section -- PgBouncer Parameters
  resources:
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

# =====================================================================
# Service Mesh Integration
# =====================================================================

serviceMesh:
  # -- (bool) Enable service mesh integration
  # @section -- Service Mesh Parameters
  enabled: false

  # -- (string) Service mesh provider (istio, linkerd, consul)
  # @section -- Service Mesh Parameters
  provider: "istio"

  # -- (object) Istio-specific configuration
  # @section -- Service Mesh Parameters
  istio:
    # Enable mutual TLS
    mtls:
      mode: PERMISSIVE # DISABLE, PERMISSIVE, STRICT
    # Traffic policy
    trafficPolicy:
      connectionPool:
        tcp:
          maxConnections: 100
        http:
          http1MaxPendingRequests: 100
          http2MaxRequests: 100
      loadBalancer:
        simple: LEAST_CONN
    # Inject sidecar
    injection: true

  # -- (object) Linkerd-specific configuration
  # @section -- Service Mesh Parameters
  linkerd:
    # Enable injection
    injection: true
    # Skip inbound ports
    skipInboundPorts: ""
    # Skip outbound ports
    skipOutboundPorts: ""

# =====================================================================
# Kubernetes Integration
# =====================================================================

kubernetesIntegration:
  # -- (bool) Enable automatic config reload on ConfigMap/Secret changes
  # @section -- Kubernetes Integration Parameters
  autoReload:
    enabled: false
    # Requires Reloader: https://github.com/stakater/Reloader
    # Will add annotations to trigger pod restart on config changes

  # -- (object) Pod disruption windows for maintenance
  # @section -- Kubernetes Integration Parameters
  disruptionWindows:
    enabled: false
    # Example: Allow disruptions only during maintenance windows
    # startTime: "02:00"
    # endTime: "04:00"
    # timezone: "UTC"
    # daysOfWeek: ["Saturday", "Sunday"]

  # -- (bool) Enable enhanced Kubernetes event generation
  # @section -- Kubernetes Integration Parameters
  enhancedEvents: true

  # -- (object) Resource recommendations via VPA
  # @section -- Kubernetes Integration Parameters
  resourceRecommendations:
    enabled: false
    updateMode: "Off" # Off, Initial, Recreate, Auto

# =====================================================================
# User Management
# =====================================================================

userManagement:
  # -- (object) Dynamic user synchronization without pod restart
  # @section -- User Management Parameters
  dynamicSync:
    # -- (bool) Enable dynamic user/database synchronization via CronJob
    enabled: false

    # -- (string) Cron schedule for sync job
    # Examples:
    # - "*/5 * * * *" - Every 5 minutes
    # - "0 * * * *" - Every hour
    # - "@hourly" - Every hour
    # Can also be triggered manually: kubectl create job --from=cronjob/<name> <job-name>
    schedule: "*/15 * * * *"

    # -- (bool) Suspend the CronJob (useful for manual-only execution)
    suspend: false

    # -- (int) Number of successful jobs to keep
    successfulJobsHistoryLimit: 3

    # -- (int) Number of failed jobs to keep
    failedJobsHistoryLimit: 3

    # -- (string) ConfigMap containing SQL scripts for user/database sync
    # The ConfigMap should contain .sql files that will be executed
    # Scripts should be idempotent (use IF NOT EXISTS checks)
    configMapName: ""

    # -- (object) Watch external ConfigMaps for user/database definitions (cross-namespace)
    watchExternalResources:
      enabled: false
      # List of ConfigMaps to mount and execute scripts from
      configMaps: []
        # - name: app-team-scripts
        #   namespace: app-team

    # -- (object) Pod annotations for the sync job
    podAnnotations: {}

    # -- (object) Resources for the sync job container
    resources:
      requests:
        cpu: 10m
        memory: 32Mi
      limits:
        cpu: 100m
        memory: 128Mi

# =====================================================================
# Extra Objects
# =====================================================================

extraObjects:
  # -- (array) Extra Kubernetes objects to create
  # @section -- Extra Parameters
  objects: []
    # - apiVersion: v1
    #   kind: ConfigMap
    #   metadata:
    #     name: extra-config
    #   data:
    #     key: value
