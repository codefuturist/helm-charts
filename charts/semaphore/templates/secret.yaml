{{- if not .Values.semaphore.existingSecret }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "semaphore.fullname" . }}
  namespace: {{ include "semaphore.namespace" . }}
  labels:
    {{- include "semaphore.labels" . | nindent 4 }}
  {{- with .Values.additionalAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
type: Opaque
stringData:
  {{- if ne .Values.semaphore.database.dialect "bolt" }}
  database-password: {{ .Values.semaphore.database.password | required "semaphore.database.password is required when using external database" | quote }}
  {{- end }}
  admin-password: {{ .Values.semaphore.admin.password | required "semaphore.admin.password is required" | quote }}
  cookie-hash: {{ .Values.semaphore.security.cookieHash | required "semaphore.security.cookieHash is required" | quote }}
  {{- if .Values.semaphore.security.cookieEncryption }}
  cookie-encryption: {{ .Values.semaphore.security.cookieEncryption | quote }}
  {{- end }}
  access-key-encryption: {{ .Values.semaphore.security.accessKeyEncryption | required "semaphore.security.accessKeyEncryption is required" | quote }}
  {{- if .Values.semaphore.runner.enabled }}
  runner-token: {{ .Values.semaphore.runner.registrationToken | required "semaphore.runner.registrationToken is required when runner is enabled" | quote }}
  {{- end }}
  {{- if and .Values.semaphore.email.enabled .Values.semaphore.email.password }}
  email-password: {{ .Values.semaphore.email.password | quote }}
  {{- end }}
  {{- if .Values.semaphore.ldap.enabled }}
  ldap-password: {{ .Values.semaphore.ldap.bindPassword | required "semaphore.ldap.bindPassword is required when LDAP is enabled" | quote }}
  {{- end }}
  {{- if .Values.semaphore.messengers.telegram.enabled }}
  telegram-token: {{ .Values.semaphore.messengers.telegram.token | required "semaphore.messengers.telegram.token is required when Telegram is enabled" | quote }}
  {{- end }}
  {{- if .Values.semaphore.messengers.slack.enabled }}
  slack-url: {{ .Values.semaphore.messengers.slack.url | required "semaphore.messengers.slack.url is required when Slack is enabled" | quote }}
  {{- end }}
  {{- if .Values.semaphore.messengers.rocketchat.enabled }}
  rocketchat-url: {{ .Values.semaphore.messengers.rocketchat.url | required "semaphore.messengers.rocketchat.url is required when RocketChat is enabled" | quote }}
  {{- end }}
  {{- if .Values.semaphore.messengers.microsoftTeams.enabled }}
  microsoft-teams-url: {{ .Values.semaphore.messengers.microsoftTeams.url | required "semaphore.messengers.microsoftTeams.url is required when Microsoft Teams is enabled" | quote }}
  {{- end }}
  {{- if .Values.semaphore.messengers.dingtalk.enabled }}
  dingtalk-url: {{ .Values.semaphore.messengers.dingtalk.url | required "semaphore.messengers.dingtalk.url is required when DingTalk is enabled" | quote }}
  {{- end }}
  {{- if .Values.semaphore.messengers.gotify.enabled }}
  gotify-token: {{ .Values.semaphore.messengers.gotify.token | required "semaphore.messengers.gotify.token is required when Gotify is enabled" | quote }}
  {{- end }}
{{- end }}
