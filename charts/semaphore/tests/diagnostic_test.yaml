suite: test uptime-kuma diagnostic mode
templates:
  - deployment.yaml
tests:
  - it: should not enable diagnostic mode by default
    asserts:
      - notContains:
          path: spec.template.spec.containers[0].command
          content: /bin/sh

  - it: should enable diagnostic mode when configured
    set:
      diagnosticMode.enabled: true
    asserts:
      - contains:
          path: spec.template.spec.containers[0].command
          content: /bin/sh

  - it: should override command in diagnostic mode
    set:
      diagnosticMode.enabled: true
      diagnosticMode:
        command:
          - /bin/bash
    asserts:
      - equal:
          path: spec.template.spec.containers[0].command[0]
          value: /bin/bash

  - it: should override args in diagnostic mode
    set:
      diagnosticMode.enabled: true
      diagnosticMode:
        args:
          - -c
          - while true; do sleep 30; done
    asserts:
      - contains:
          path: spec.template.spec.containers[0].args
          content: -c
