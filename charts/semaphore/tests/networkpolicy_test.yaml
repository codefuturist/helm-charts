suite: test uptime-kuma network policy
templates:
  - networkpolicy.yaml
tests:
  - it: should not create NetworkPolicy by default
    asserts:
      - hasDocuments:
          count: 0

  - it: should create NetworkPolicy when enabled
    set:
      networkPolicy.enabled: true
    asserts:
      - isKind:
          of: NetworkPolicy
      - equal:
          path: metadata.name
          value: RELEASE-NAME-uptime-kuma

  - it: should configure ingress and egress policy types
    set:
      networkPolicy.enabled: true
      networkPolicy:
        policyTypes:
          - Ingress
          - Egress
    asserts:
      - contains:
          path: spec.policyTypes
          content: Ingress
      - contains:
          path: spec.policyTypes
          content: Egress

  - it: should configure custom ingress rules
    set:
      networkPolicy.enabled: true
      networkPolicy.ingress[0].from[0].namespaceSelector.matchLabels.name: "ingress-nginx"
    asserts:
      - equal:
          path: spec.ingress[0].from[0].namespaceSelector.matchLabels.name
          value: "ingress-nginx"

  - it: should configure custom egress rules
    set:
      networkPolicy.enabled: true
      networkPolicy.egress[0].to[0].namespaceSelector.matchLabels.name: "monitoring"
    asserts:
      - equal:
          path: spec.egress[0].to[0].namespaceSelector.matchLabels.name
          value: "monitoring"
